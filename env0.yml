version: 1

deploy:
  steps:
    terraformApply:
      before:
        - |
            set -e
            pip3 install pyvmomi requests
            COMMON="--esx-hostname=$HOST --esx-username=$USER --esx-password=$PASSWORD --esx-port=$PORT --no-verify-cert --clone-name=clone-$ENV0_WORKSPACE_NAME"
            python3 main.py $COMMON clone --cloner-esx-username=$USER --cloner-esx-hostname=$HOST --cloner-esx-password="$PASSWORD" --cloner-esx-port=$PORT --vm-to-clone="env0-Vanila" --cloner-vm-name="env0-Cloner" --cloner-password=1
            python3 main.py $COMMON run "cmd" "/c \"echo hi\""

destroy:
  steps:
    terraformDestroy:
      after:
        - |
            set -e
            pip3 install pyvmomi requests
            COMMON="--esx-hostname=$HOST --esx-username=$USER --esx-password=$PASSWORD --esx-port=$PORT --no-verify-cert --clone-name=clone-$ENV0_WORKSPACE_NAME"
            python3 main.py $COMMON destroy
