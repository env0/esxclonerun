version: 1

deploy:
  steps:
    terraformApply:
      before:
        - |
            set -e
            pip3 install pyvmomi requests
            COMMON="--esx-hostname=$HOST --esx-username=$USER --esx-password=$PASSWORD --no-verify-cert --clone-name=clone-$ENV0_WORKSPACE_NAME"
            python3 main.py $COMMON clone --cloner-esx-username=$USER --cloner-esx-hostname=$HOST --cloner-esx-password="$PASSWORD" --vm-to-clone="to_clone"
            python3 main.py $COMMON bash "ls -l"

destroy:
  steps:
    terraformDestroy:
      after:
        - |
            set -e
            pip3 install pyvmomi requests
            COMMON="--esx-hostname=$HOST --esx-username=$USER --esx-password=$PASSWORD --no-verify-cert --clone-name=clone-$ENV0_WORKSPACE_NAME"
            python3 main.py $COMMON destroy
